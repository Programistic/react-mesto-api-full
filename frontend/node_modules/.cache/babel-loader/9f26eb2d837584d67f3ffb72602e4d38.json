{"ast":null,"code":"import _toConsumableArray from\"/home/maksim/dev/react-mesto-api-full/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _classCallCheck from\"/home/maksim/dev/react-mesto-api-full/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/home/maksim/dev/react-mesto-api-full/frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _assertThisInitialized from\"/home/maksim/dev/react-mesto-api-full/frontend/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";import _inherits from\"/home/maksim/dev/react-mesto-api-full/frontend/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/home/maksim/dev/react-mesto-api-full/frontend/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import{Component}from'react';import{Route,Switch,Redirect,withRouter}from'react-router-dom';import{CurrentUserContext}from'../contexts/CurrentUserContext';import api from'../utils/Api';import Header from'./Header';import Main from'./Main';import Footer from'./Footer';import EditProfilePopup from'./EditProfilePopup';import EditAvatarPopup from'./EditAvatarPopup';import AddPlacePopup from'./AddPlacePopup';import ImagePopup from'./ImagePopup';import ConfirmDeletePopup from'./ConfirmDeletePopup';import ProtectedRoute from'./ProtectedRoute';import Register from'./Register';import Login from'./Login';import InfoTooltip from'./InfoTooltip';import*as Auth from'../utils/Auth';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var App=/*#__PURE__*/function(_Component){_inherits(App,_Component);var _super=_createSuper(App);function App(props){var _this;_classCallCheck(this,App);_this=_super.call(this,props);_this.handleEditProfileClick=function(){_this.setState({isEditProfilePopupOpen:true});};_this.handleAddPlaceClick=function(){_this.setState({isAddPlacePopupOpen:true});};_this.handleEditAvatarClick=function(){_this.setState({isEditAvatarPopupOpen:true});};_this.handleConfirmDeleteCardClick=function(){_this.setState({isConfirmPopupOpen:true});};_this.handleEscClick=function(event){if(event.key==='Escape'){_this.closeAllPopups();}};_this.handleOutsideClick=function(event){if(event.target.classList.contains('popup')){_this.closeAllPopups();}};_this.handleUpdateUser=function(userName,userDescription){api.setUserInfo(userName,userDescription).then(function(userData){_this.setState({currentUser:userData});_this.closeAllPopups();}).catch(function(err){console.log(err);});};_this.handleUpdateAvatar=function(userAvatar){api.setAvatar(userAvatar).then(function(userData){_this.setState({currentUser:userData});_this.closeAllPopups();}).catch(function(err){console.log(err);});};_this.handleCardLike=function(card){var isLiked=card.likes.some(function(like){return like._id===_this.state.currentUser._id;});api.changeLikeCardStatus(card._id,isLiked).then(function(getCard){_this.setState({cards:_this.state.cards.map(function(oldCard){return oldCard._id===getCard._id?getCard:oldCard;})});}).catch(function(err){console.log(err);});};_this.handleCardDelete=function(){api.deleteCard(_this.state.deleteCard._id).then(function(){_this.setState({cards:_this.state.cards.filter(function(currentCard){return currentCard._id!==_this.state.deleteCard._id;}),isConfirmPopupOpen:false});}).catch(function(err){console.log(err);});};_this.handleCardClick=function(card){_this.setState({selectedCard:card});};_this.handleAddPlace=function(placeName,placeImage){api.setCard(placeName,placeImage).then(function(newCard){_this.setState({cards:[newCard].concat(_toConsumableArray(_this.state.cards))});_this.closeAllPopups();}).catch(function(err){console.log(err);});};_this.closeAllPopups=function(){_this.setState({isEditProfilePopupOpen:false,isAddPlacePopupOpen:false,isEditAvatarPopupOpen:false,isConfirmPopupOpen:false,isInfoTooltipOpen:false,selectedCard:{}});};_this.openConfirmDeletePopup=function(card){_this.setState({deleteCard:card,isConfirmPopupOpen:true});};_this.resetLoggedIn=function(){_this.setState({loggedIn:false});};_this.tokenCheck=function(){var jwt=localStorage.getItem('jwt');if(jwt){Auth.getContent(jwt).then(function(res){if(res){_this.setState({loggedIn:true,userEmail:res.data.email},function(){_this.props.history.push(\"/main\");});}}).catch(function(err){console.log(err);});}};_this.handleRegisterSubmit=function(userEmail,userPassword){Auth.register(userEmail,userPassword).then(function(res){if(res){_this.openTooltipSuccess(userEmail);}else{_this.openTooltipFail();}}).catch(function(err){console.log(err);});};_this.handleLoginSubmit=function(userEmail,userPassword){Auth.authorize(userEmail,userPassword).then(function(data){if(data!==undefined&&data.token){localStorage.setItem('jwt',data.token);_this.setState({loggedIn:true,userEmail:userEmail});_this.props.history.push(\"/main\");}else{_this.openTooltipFail();}}).catch(function(err){console.log(err);});};_this.openTooltipSuccess=function(userEmail){_this.setState({isSuccess:true,loggedIn:true,userEmail:userEmail,isInfoTooltipOpen:true,infoTooltipButtonName:'success',infoTooltipMessage:'Вы успешно зарегистрировались!'});};_this.openTooltipFail=function(){_this.setState({isSuccess:false,isInfoTooltipOpen:true,infoTooltipButtonName:'fail',infoTooltipMessage:'Что-то пошло не так! Попробуйте ещё раз.'});};_this.handleConfirmRegister=function(){_this.closeAllPopups();if(_this.state.isSuccess){_this.props.history.push(\"/main\");}};_this.state={isEditProfilePopupOpen:false,isAddPlacePopupOpen:false,isEditAvatarPopupOpen:false,isConfirmPopupOpen:false,isInfoTooltipOpen:false,infoTooltipButtonName:'',infoTooltipMessage:'',isSuccess:false,userEmail:'',selectedCard:{},deleteCard:{},cards:[],currentUser:{},loggedIn:false};_this.tokenCheck=_this.tokenCheck.bind(_assertThisInitialized(_this));return _this;}_createClass(App,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;api.getUserInfo().then(function(userData){_this2.setState({currentUser:userData});}).catch(function(err){console.log(err);});api.getCards().then(function(getCardsArray){_this2.setState({cards:getCardsArray});}).catch(function(err){console.log(err);});this.tokenCheck();document.addEventListener(\"keydown\",this.handleEscClick);document.addEventListener(\"click\",this.handleOutsideClick);}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){document.removeEventListener(\"keydown\",this.handleEscClick);document.addEventListener(\"click\",this.handleOutsideClick);}},{key:\"render\",value:function render(){return/*#__PURE__*/_jsx(\"div\",{className:\"page\",children:/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:/*#__PURE__*/_jsxs(CurrentUserContext.Provider,{value:this.state.currentUser,children:[/*#__PURE__*/_jsx(Header,{userEmail:this.state.userEmail,resetLoggedIn:this.resetLoggedIn,loggedIn:this.state.loggedIn}),/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(ProtectedRoute,{exact:true,path:\"/main\",loggedIn:this.state.loggedIn,cards:this.state.cards,onEditProfile:this.handleEditProfileClick,onAddPlace:this.handleAddPlaceClick,onEditAvatar:this.handleEditAvatarClick,onCardLike:this.handleCardLike,onCardDelete:this.openConfirmDeletePopup,onCardClick:this.handleCardClick,component:Main}),/*#__PURE__*/_jsx(Route,{path:\"/signin\",children:/*#__PURE__*/_jsx(Login,{handleLoginSubmit:this.handleLoginSubmit})}),/*#__PURE__*/_jsx(Route,{path:\"/signup\",children:/*#__PURE__*/_jsx(Register,{handleRegisterSubmit:this.handleRegisterSubmit})}),/*#__PURE__*/_jsx(Route,{children:this.state.loggedIn?/*#__PURE__*/_jsx(Redirect,{to:\"/main\"}):/*#__PURE__*/_jsx(Redirect,{to:\"/signin\"})})]}),this.state.loggedIn&&/*#__PURE__*/_jsx(Footer,{}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:this.state.isEditProfilePopupOpen,onUpdateUser:this.handleUpdateUser,onClose:this.closeAllPopups}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:this.state.isEditAvatarPopupOpen,onUpdateAvatar:this.handleUpdateAvatar,onClose:this.closeAllPopups}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:this.state.isAddPlacePopupOpen,onAddPlace:this.handleAddPlace,onClose:this.closeAllPopups}),/*#__PURE__*/_jsx(ConfirmDeletePopup,{isOpen:this.state.isConfirmPopupOpen,onConfirmDeleteCard:this.handleCardDelete,onClose:this.closeAllPopups}),/*#__PURE__*/_jsx(ImagePopup,{card:this.state.selectedCard,onClose:this.closeAllPopups}),/*#__PURE__*/_jsx(InfoTooltip,{isOpen:this.state.isInfoTooltipOpen,message:this.state.infoTooltipMessage,buttonName:this.state.infoTooltipButtonName,onConfirm:this.handleConfirmRegister})]})})});}}]);return App;}(Component);export default withRouter(App);","map":{"version":3,"sources":["/home/maksim/dev/react-mesto-api-full/frontend/src/components/App.js"],"names":["Component","Route","Switch","Redirect","withRouter","CurrentUserContext","api","Header","Main","Footer","EditProfilePopup","EditAvatarPopup","AddPlacePopup","ImagePopup","ConfirmDeletePopup","ProtectedRoute","Register","Login","InfoTooltip","Auth","App","props","handleEditProfileClick","setState","isEditProfilePopupOpen","handleAddPlaceClick","isAddPlacePopupOpen","handleEditAvatarClick","isEditAvatarPopupOpen","handleConfirmDeleteCardClick","isConfirmPopupOpen","handleEscClick","event","key","closeAllPopups","handleOutsideClick","target","classList","contains","handleUpdateUser","userName","userDescription","setUserInfo","then","userData","currentUser","catch","err","console","log","handleUpdateAvatar","userAvatar","setAvatar","handleCardLike","card","isLiked","likes","some","like","_id","state","changeLikeCardStatus","getCard","cards","map","oldCard","handleCardDelete","deleteCard","filter","currentCard","handleCardClick","selectedCard","handleAddPlace","placeName","placeImage","setCard","newCard","isInfoTooltipOpen","openConfirmDeletePopup","resetLoggedIn","loggedIn","tokenCheck","jwt","localStorage","getItem","getContent","res","userEmail","data","email","history","push","handleRegisterSubmit","userPassword","register","openTooltipSuccess","openTooltipFail","handleLoginSubmit","authorize","undefined","token","setItem","isSuccess","infoTooltipButtonName","infoTooltipMessage","handleConfirmRegister","bind","getUserInfo","getCards","getCardsArray","document","addEventListener","removeEventListener"],"mappings":"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","sourcesContent":["import { Component } from 'react';\nimport { Route, Switch, Redirect, withRouter } from 'react-router-dom';\nimport { CurrentUserContext } from '../contexts/CurrentUserContext';\nimport api from '../utils/Api';\nimport Header from './Header';\nimport Main from './Main';\nimport Footer from './Footer';\nimport EditProfilePopup from './EditProfilePopup';\nimport EditAvatarPopup from './EditAvatarPopup';\nimport AddPlacePopup from './AddPlacePopup';\nimport ImagePopup from './ImagePopup';\nimport ConfirmDeletePopup from './ConfirmDeletePopup';\nimport ProtectedRoute from './ProtectedRoute';\nimport Register from './Register';\nimport Login from './Login';\nimport InfoTooltip from './InfoTooltip';\nimport * as Auth from '../utils/Auth';\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      isEditProfilePopupOpen: false,\n      isAddPlacePopupOpen: false,\n      isEditAvatarPopupOpen: false,\n      isConfirmPopupOpen: false,\n      isInfoTooltipOpen: false,\n      infoTooltipButtonName: '',\n      infoTooltipMessage: '',\n      isSuccess: false,\n      userEmail: '',\n      selectedCard: {},\n      deleteCard: {},\n      cards: [],\n      currentUser: {},\n      loggedIn: false,\n    };\n\n    this.tokenCheck = this.tokenCheck.bind(this);\n  }\n\n  handleEditProfileClick = () => {\n    this.setState({ isEditProfilePopupOpen: true });\n  }\n\n  handleAddPlaceClick = () => {\n    this.setState({ isAddPlacePopupOpen: true });\n  }\n\n  handleEditAvatarClick = () => {\n    this.setState({ isEditAvatarPopupOpen: true });\n  }\n\n  handleConfirmDeleteCardClick = () => {\n    this.setState({ isConfirmPopupOpen: true });\n  }\n\n  handleEscClick = (event) => {\n    if (event.key === 'Escape') {\n      this.closeAllPopups();\n    }\n  }\n\n  handleOutsideClick = (event) => {\n    if (event.target.classList.contains('popup')) {\n      this.closeAllPopups();\n    }\n  }\n\n  handleUpdateUser = (userName, userDescription) => {\n    api.setUserInfo(userName, userDescription)\n      .then(userData => {\n        this.setState({ currentUser: userData });\n        this.closeAllPopups();\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  }\n\n  handleUpdateAvatar = (userAvatar) => {\n    api.setAvatar(userAvatar)\n      .then(userData => {\n        this.setState({ currentUser: userData });\n        this.closeAllPopups();\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  }\n\n  handleCardLike = (card) => {\n    const isLiked = card.likes.some(like => like._id === this.state.currentUser._id);\n    api.changeLikeCardStatus(card._id, isLiked)\n      .then(getCard => {\n        this.setState({ cards: this.state.cards.map(oldCard => oldCard._id === getCard._id ? getCard : oldCard) });\n      })\n      .catch(err => {\n        console.log(err);\n      });\n  }\n\n  handleCardDelete = () => {\n    api.deleteCard(this.state.deleteCard._id)\n      .then(() => {\n        this.setState({\n          cards: this.state.cards.filter(currentCard => currentCard._id !== this.state.deleteCard._id),\n          isConfirmPopupOpen: false\n        }); \n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  }\n\n  handleCardClick = (card) => {\n    this.setState({ selectedCard: card });\n  }\n\n  handleAddPlace = (placeName, placeImage) => {\n    api.setCard(placeName, placeImage)\n    .then(newCard => {\n      this.setState({ cards: [newCard, ...this.state.cards] });\n      this.closeAllPopups();\n    })\n    .catch((err) => {\n      console.log(err);\n    });\n  }\n\n  componentDidMount() {\n    api.getUserInfo()\n      .then(userData => {\n        this.setState({ currentUser: userData });\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n\n      api.getCards()\n      .then(getCardsArray => {\n        this.setState({ cards: getCardsArray });\n      })\n      .catch(err => {\n        console.log(err);\n      });\n\n    this.tokenCheck();\n\n    document.addEventListener(\"keydown\", this.handleEscClick);\n    document.addEventListener(\"click\", this.handleOutsideClick);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener(\"keydown\", this.handleEscClick);\n    document.addEventListener(\"click\", this.handleOutsideClick);\n  }\n\n  closeAllPopups = () => {\n    this.setState({\n      isEditProfilePopupOpen: false,\n      isAddPlacePopupOpen: false,\n      isEditAvatarPopupOpen: false,\n      isConfirmPopupOpen: false,\n      isInfoTooltipOpen: false,\n      selectedCard: {}\n    });\n  }\n\n  openConfirmDeletePopup = (card) => {\n    this.setState({\n      deleteCard: card,\n      isConfirmPopupOpen: true\n    });\n  }\n\n  resetLoggedIn = () => {\n    this.setState({\n      loggedIn: false\n    })\n  }\n\n  tokenCheck = () => {\n    const jwt = localStorage.getItem('jwt');\n    if (jwt) {\n      Auth.getContent(jwt)\n        .then((res) => {\n          if (res) {\n            this.setState({\n              loggedIn: true,\n              userEmail: res.data.email\n            }, () => {\n              this.props.history.push(\"/main\");\n            });\n          }\n        })\n        .catch((err) => {\n          console.log(err);\n        })\n    }\n  }\n\n  handleRegisterSubmit = (userEmail, userPassword) => {\n    Auth.register(userEmail, userPassword)\n      .then((res) => {\n        if(res) {\n          this.openTooltipSuccess(userEmail);\n        } else {\n          this.openTooltipFail();\n        }\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  }\n\n  handleLoginSubmit = (userEmail, userPassword) => {\n    Auth.authorize(userEmail, userPassword)\n      .then((data) => {\n        if (data !== undefined && data.token) {\n          localStorage.setItem('jwt', data.token);\n          this.setState({\n            loggedIn: true,\n            userEmail: userEmail\n          });\n          this.props.history.push(\"/main\");\n        } else {\n          this.openTooltipFail();\n        }\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  }\n\n  openTooltipSuccess = (userEmail) => {\n    this.setState({\n      isSuccess: true,\n      loggedIn: true,\n      userEmail: userEmail,\n      isInfoTooltipOpen: true,\n      infoTooltipButtonName: 'success',\n      infoTooltipMessage: 'Вы успешно зарегистрировались!'\n    });\n  }\n\n  openTooltipFail = () => {\n    this.setState({\n      isSuccess: false,\n      isInfoTooltipOpen: true,\n      infoTooltipButtonName: 'fail',\n      infoTooltipMessage: 'Что-то пошло не так! Попробуйте ещё раз.'\n    });\n  }\n\n  handleConfirmRegister = () => {\n    this.closeAllPopups();\n    if(this.state.isSuccess) {\n      this.props.history.push(\"/main\");\n    } \n  }\n\n  render() {\n    return (\n      <div className=\"page\">\n        <div className=\"container\">\n\n          <CurrentUserContext.Provider value={this.state.currentUser}>\n\n            <Header userEmail={this.state.userEmail} resetLoggedIn={this.resetLoggedIn} loggedIn={this.state.loggedIn} />\n\n            <Switch>\n\n              <ProtectedRoute\n                exact path=\"/main\"\n                loggedIn={this.state.loggedIn}\n                cards={this.state.cards}\n                onEditProfile={this.handleEditProfileClick}\n                onAddPlace={this.handleAddPlaceClick}\n                onEditAvatar={this.handleEditAvatarClick}\n                onCardLike={this.handleCardLike}\n                onCardDelete={this.openConfirmDeletePopup}\n                onCardClick={this.handleCardClick}\n                component={Main}>\n              </ProtectedRoute>\n\n              <Route path=\"/signin\">\n                <Login handleLoginSubmit={this.handleLoginSubmit} />\n              </Route>\n\n              <Route path=\"/signup\">\n                <Register handleRegisterSubmit={this.handleRegisterSubmit} />\n              </Route>\n\n              <Route>\n                {this.state.loggedIn ? <Redirect to=\"/main\" /> : <Redirect to=\"/signin\" />}\n              </Route>\n\n            </Switch>\n\n            {this.state.loggedIn && <Footer />}\n            \n            <EditProfilePopup\n              isOpen={this.state.isEditProfilePopupOpen}\n              onUpdateUser={this.handleUpdateUser}\n              onClose={this.closeAllPopups}\n            />\n\n            <EditAvatarPopup\n              isOpen={this.state.isEditAvatarPopupOpen}\n              onUpdateAvatar={this.handleUpdateAvatar}\n              onClose={this.closeAllPopups}\n            />\n\n            <AddPlacePopup\n              isOpen={this.state.isAddPlacePopupOpen}\n              onAddPlace={this.handleAddPlace}\n              onClose={this.closeAllPopups}\n            />\n\n            <ConfirmDeletePopup\n              isOpen={this.state.isConfirmPopupOpen}\n              onConfirmDeleteCard={this.handleCardDelete}\n              onClose={this.closeAllPopups}\n            />\n\n            <ImagePopup\n              card={this.state.selectedCard}\n              onClose={this.closeAllPopups}\n            />\n\n            <InfoTooltip\n              isOpen={this.state.isInfoTooltipOpen}\n              message={this.state.infoTooltipMessage}\n              buttonName={this.state.infoTooltipButtonName}\n              onConfirm={this.handleConfirmRegister}\n            />\n            \n          </CurrentUserContext.Provider>\n          \n        </div>\n      </div>\n    );\n  } \n}\n\nexport default withRouter(App);\n\n"]},"metadata":{},"sourceType":"module"}